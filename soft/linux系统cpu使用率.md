查看系统cpu使用率：

    使用 vmstat 查看系统维度的cpu负载
    使用 top 查看进程维度的cpu负载

##### 使用 vmstat 查看系统维度的cpu负载 #####
``` shell 
每秒刷新一次
# vmstat -n 1 
```

    procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
    r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
    1  0      0 244412   3112 23250324    0    0     1    33    2    5  5  5 90  0  0
    2  0      0 243828   3112 23250564    0    0     0     0 13553 29650  3  3 94  0  0
    3  0      0 243524   3112 23251264    0    0     0     0 16163 32435  6  4 91  0  0
    2  0      0 243064   3112 23251300    0    0     0     0 13941 25124  3  3 94  0  0
    5  0      0 241464   3112 23251316    0    0     0   248 13521 29823  2  2 95  0  0
    1  0      0 245092   3112 23250964    0    0     0     0 18330 37070  2  3 94  0  0
    0  0      0 243228   3112 23251192    0    0     0     0 18609 33652  4  3 93  0  0

显示主要数据说明：

    r:  表示系统中cpu等待处理的线程。该数值越大，通常表示系统运行越慢。
    us: 用户模式消耗的 CPU 时间百分比。该值较高时，说明用户进程消耗的 CPU 时间比较多
    sy: 内核模式消耗的 CPU 时间百分比。
    wa: IO 等待消耗的 CPU 时间百分比。该值较高时，说明 IO 等待比较严重，这可能磁盘大量作随机访问造成的，也可能是磁盘性能出现了瓶颈。
    id: 处于空闲状态的 CPU 时间百分比。如果该值持续为 0，同时 sy 是 us 的两倍，则通常说明系统则面临着 CPU 资源的短缺。

##### 使用 top 查看进程维度的cpu负载  #####
```shell
# top 
```
操作说明：

    直接在界面输入大写字母 P ,来使监控结果按cpu使用率倒序排列。
    输入大写字母 M(shift+m),使用监控结果按memery使用率倒序排列。
    输入数字 1，可监控每个逻辑 cpu 的状况。
    输入 x ，打开排序列的加亮效果
    通过 "shift + >" 或"shift + <" 可以向右或向左改变排序列

###### 1) top界面终止进程  ######
    
    1) 按下小写 k 键
    2) 输入要终止的进程pid,再回车

###### 2） cpu使用率较低但负载较高  ######
通过top看到 cpu很空间，但是load average却非常高：

处理办法：

    load average是对CPU负载的评估，其值越高，说明其任务队列越长，处于等待执行的任务越多。
    出现这种情况时，可能是僵死进程导致的。可以通过 ps -axjf 查看是否存在 D 状态进程。
    D 状态是指不可中断的睡眠状态。该状态的进程无法被kill,也无法自行退出。只能通过恢复其依赖的资源或重启系统来解决。
```shell
# ps -axjf
```

###### 3) kswapd0 进程占用cpu较高  ######
操作系统都用分页机制来管理物理内存，操作系统将磁盘的一部分划出来作为虚拟内存，由于内存的速度要比磁盘快得多，所以操作系统要按照某种换页机制将不需要的页面换到磁盘中，将需要的页面调到内存中。

由于内存持续不足，这个换页动作持续进行，kswapd0是虚拟内存管理中负责换页的，当服务器内存不足的时候kswapd0会执行换页操作，这个换页操作是十分消耗主机CPU资源的。

如果通过top发现该进程持续处于非睡眠状态，且运行时间较长，可以初步判定系统在持续的进行换页操作，可以将问题转向内存不足的原因来排查。

可以通过 free 、ps 等指令进一步查询系统及系统内进程的内存占用情况


###### 4） top命令的补充  ######
``` shell 
查看java线程数
# ps -ef|grep java | wc -l

监控网络客户连接数
# netstat -n | grep tcp |grep [port] | wc -l

查看某进程pid的线程数
# ls /proc/{PID}/task  |wc -l
```


